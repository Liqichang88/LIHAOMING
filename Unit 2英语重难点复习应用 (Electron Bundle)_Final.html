<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit 2 è‹±è¯­é‡éš¾ç‚¹å¤ä¹ åº”ç”¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .flashcard {
            min-height: 240px; 
            cursor: pointer;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            position: relative;
        }
        .flashcard-inner {
            position: absolute;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .flashcard.flipped .flashcard-inner {
            transform: rotateY(180deg);
        }
        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .flashcard-front {
            background-color: #4f46e5;
            color: white;
            font-size: 1.5rem;
            font-weight: 600;
        }
        .flashcard-back {
            background-color: white;
            color: #1f2937;
            font-size: 1.5rem;
            font-weight: 600;
            transform: rotateY(180deg);
            border: 2px solid #4f46e5;
        }
        .tab-active {
            border-bottom: 3px solid #4f46e5;
            color: #4f46e5;
            font-weight: 600;
        }
        /* Style for the custom input display (Applies to Grammar & Completion) */
        #grammar-quiz-display, #completion-quiz-display {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
            line-height: 2.5rem; 
        }
        /* Reduced input width and margin for tighter spacing in Completion Quiz */
        #grammar-quiz-display input, #completion-quiz-display input {
            display: inline-block;
            width: 100px; 
            margin: 0 3px; 
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            padding: 2px 5px;
            background-color: #fffbeb; 
        }
        .blank {
            color: #f97316; /* Orange color for blanks */
        }
        
        /* Cloze Test Styles */
        .cloze-passage-text {
            font-size: 1.125rem; 
            line-height: 2.5rem; 
            text-align: justify;
            margin-top: 1rem;
        }
        
        /* Cloze Blank Container: Redefining to center the underline */
        .cloze-placeholder {
            display: inline-flex; 
            flex-direction: column;
            align-items: center;
            margin: 0 2px; 
            min-width: 60px; 
            box-sizing: content-box; 
            height: 2.5rem; 
            justify-content: center; 
            vertical-align: middle; 
            padding-top: 0; 
        }
        .cloze-number {
            font-weight: 700;
            color: #ef4444; 
            font-size: 0.8rem; 
            line-height: 1; 
            margin-bottom: 0.5rem; 
        }
        .cloze-underline {
            display: block;
            width: 100%;
            height: 1px;
            border-bottom: 2px dashed #374151; 
            margin-bottom: 0; 
        }

        /* Styles for making Cloze options strictly 4 per line, non-wrapping */
        .cloze-options-row {
            display: flex;
            justify-content: space-between; 
            flex-wrap: nowrap; 
            gap: 0.75rem; 
            margin-top: 0.5rem;
            overflow-x: auto; 
            padding-bottom: 0.25rem; 
        }
        /* Style for each individual option label */
        .cloze-options-row label {
            flex: 1; 
            white-space: nowrap; 
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
            
            /* Visual improvements */
            display: flex;
            align-items: center;
            justify-content: center; 
            text-align: center;
            font-weight: 500;
            min-height: 1.5rem; 
            padding: 0.25rem 0.25rem; 
            border: 1px solid #d1d5db; 
            border-radius: 0.5rem; 
            background-color: #ffffff;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            transition: all 0.2s;
        }
        
        .cloze-options-row label:hover {
            border-color: #ef4444; 
            background-color: #fef2f2; 
        }
        
        /* Hide radio button bullet for cleaner appearance, relying on label click */
        .cloze-options-row label input[type="radio"] {
            display: none; 
        }

        /* Highlight the selected option */
        .cloze-options-row label input[type="radio"]:checked + span {
            color: #ef4444; 
            font-weight: 700;
        }
        
        /* Custom Switch CSS */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #4f46e5;
        }
        input:checked + .slider:before {
            transform: translateX(24px);
        }

        /* Phonics Breakdown style */
        .phonics-breakdown {
            font-size: 1.1rem;
            font-weight: 500;
            color: #d1d5db; /* Light gray text */
            margin-top: 0.5rem;
        }
        .phonics-breakdown span {
            padding: 2px 4px;
            margin: 0 1px;
            border-radius: 4px;
            background-color: #6366f1; /* Slightly lighter indigo background */
            font-weight: 700;
            color: white;
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <header class="text-center mb-8">
        <h1 class="text-3xl sm:text-4xl font-extrabold text-gray-800">Unit 2 è‹±è¯­é‡éš¾ç‚¹å¤ä¹ åº”ç”¨</h1>
        <p class="text-gray-500 mt-1">Where do animals live? (å­¦ä¹  & æµ‹è¯•å…¨è¦†ç›–)</p>
    </header>

    <div class="flex justify-center border-b border-gray-300 mb-8 sticky top-0 bg-white z-10 rounded-t-xl shadow-md overflow-x-auto">
        <button id="tab-vocab" onclick="showSection('vocab')" class="p-3 sm:px-6 text-lg transition duration-200 tab-active whitespace-nowrap">è¯æ±‡é—ªå¡</button>
        <button id="tab-sentences" onclick="showSection('sentences')" class="p-3 sm:px-6 text-lg transition duration-200 whitespace-nowrap">é‡ç‚¹å¥å­</button>
        <button id="tab-grammar" onclick="showSection('grammar')" class="p-3 sm:px-6 text-lg transition duration-200 whitespace-nowrap">è¯­æ³•è‡ªæµ‹</button>
        <button id="tab-reading" onclick="showSection('reading')" class="p-3 sm:px-6 text-lg transition duration-200 whitespace-nowrap">é˜…è¯»ç†è§£</button>
        <button id="tab-completion" onclick="showSection('completion')" class="p-3 sm:px-6 text-lg transition duration-200 whitespace-nowrap">å®Œå…¨å¡«ç©º</button>
        <button id="tab-cloze" onclick="showSection('cloze')" class="p-3 sm:px-6 text-lg transition duration-200 whitespace-nowrap">å®Œå½¢å¡«ç©º</button>
    </div>

    <main class="max-w-4xl w-full mx-auto">
        
        <section id="section-vocab" class="review-section">
            <h2 class="text-2xl font-bold text-gray-700 mb-4">I. è¯æ±‡é—ªå¡ (ç‚¹å‡»å¡ç‰‡ç¿»é¢)</h2>
            
            <div class="flex justify-between items-center mb-4 p-4 bg-indigo-50 rounded-lg">
                <div class="flex items-center space-x-3">
                    <span class="text-sm text-indigo-700">æ˜¾ç¤ºä¸­æ–‡ç¿»è¯‘ (å¼€å…³):</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="chinese-toggle" onchange="toggleChinese()" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <p class="text-sm text-indigo-700">å½“å‰è¿›åº¦: <span id="vocab-counter">1 / 23</span></p>
            </div>

            <div id="vocab-card-container" class="flashcard-container mb-6">
                </div>
            
            <p id="audio-status" class="text-sm mt-3 text-center min-h-[1.5rem] text-gray-500">ç‚¹å‡»è¯»éŸ³æŒ‰é’®æ’­æ”¾</p>
            
            <div class="flex gap-3 mt-4">
                <button onclick="prevVocab()" class="flex-1 bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md transition duration-300">ä¸Šä¸€ä¸ªè¯æ±‡</button>
                <button onclick="nextVocab()" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-4 rounded-lg shadow-md transition duration-300">ä¸‹ä¸€ä¸ªè¯æ±‡</button>
            </div>
        </section>

        <section id="section-sentences" class="review-section hidden">
            <h2 class="text-2xl font-bold text-gray-700 mb-4">II. é‡ç‚¹å¥å­å›é¡¾ (å…ˆè¯´å‡ºè‹±æ–‡ï¼Œå†ç‚¹å‡»æ˜¾ç¤º)</h2>
            <div class="flex justify-between items-center mb-4 p-4 bg-emerald-50 rounded-lg">
                <p class="text-sm text-emerald-700">å½“å‰è¿›åº¦: <span id="sentence-counter">1 / 28</span></p>
                <div class="flex gap-3">
                    <button onclick="prevSentence()" class="bg-emerald-500 hover:bg-emerald-600 text-white font-semibold py-2 px-4 rounded-full shadow-md transition duration-300">ä¸Šä¸€å¥</button>
                    <button onclick="nextSentence()" class="bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-2 px-4 rounded-full shadow-md transition duration-300">ä¸‹ä¸€å¥</button>
                </div>
            </div>

            <div class="p-6 bg-white rounded-xl shadow-lg border border-emerald-300">
                <p id="sentence-cn" class="text-xl text-gray-800 mb-4 font-medium"></p>
                <div id="sentence-en-container" class="border-t pt-4 mt-4 hidden">
                    <p class="text-sm text-gray-500 mb-2">è‹±æ–‡åŸå¥ (English Sentence):</p>
                    <p id="sentence-en" class="text-2xl font-bold text-emerald-700"></p>
                </div>
                <button id="sentence-reveal-btn" onclick="revealSentence()" class="mt-4 w-full bg-emerald-500 hover:bg-emerald-600 text-white font-semibold py-3 px-4 rounded-lg transition duration-300">ç‚¹å‡»æ˜¾ç¤ºè‹±æ–‡åŸå¥</button>
            </div>
        </section>

        <section id="section-grammar" class="review-section hidden">
            <h2 class="text-2xl font-bold text-gray-700 mb-4">III. è¯­æ³•è‡ªæµ‹ï¼šWhere is/are & åè¯æ‰€æœ‰æ ¼</h2>

            <div class="p-6 bg-yellow-50 rounded-xl shadow-lg border border-yellow-300 mb-6">
                <p class="text-lg text-yellow-800 mb-3 font-semibold">å½“å‰è¯­æ³•ç‚¹: <span id="grammar-rule"></span></p>
                <p id="grammar-cn" class="text-md text-gray-600"></p>
            </div>

            <div class="p-6 bg-white rounded-xl shadow-lg border border-gray-200">
                <p class="text-xl text-gray-800 mb-4 font-medium">è¯·å¡«å†™æ­£ç¡®çš„å•è¯å®Œæˆå¥å­:</p>
                <div id="grammar-quiz-display">
                    </div>
                
                <p id="quiz-result" class="text-lg font-medium min-h-[30px] mt-4"></p>
                <div class="flex space-x-4 mt-4">
                    <button onclick="prevGrammar()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-3 px-4 rounded-lg transition duration-300">ä¸Šä¸€é¢˜</button>
                    <button id="check-btn" onclick="checkGrammar()" class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-3 px-4 rounded-lg transition duration-300">æäº¤ç­”æ¡ˆ</button>
                    <button onclick="nextGrammar()" class="flex-1 bg-gray-400 hover:bg-gray-500 text-white font-semibold py-3 px-4 rounded-lg transition duration-300">è·³è¿‡/ä¸‹ä¸€é¢˜</button>
                </div>
            </div>
        </section>
        
        <section id="section-reading" class="review-section hidden">
            <h2 class="text-2xl font-bold text-gray-700 mb-4">IV. é˜…è¯»ç†è§£ (Reading Comprehension)</h2>

            <div class="p-6 bg-purple-50 rounded-xl shadow-lg border border-purple-300 mb-6">
                <p id="reading-title" class="text-xl text-purple-800 mb-3 font-bold"></p>
                <p id="reading-passage" class="text-lg text-gray-700 leading-relaxed"></p>
            </div>

            <div id="reading-questions-container" class="space-y-6">
                </div>

            <div class="flex space-x-4 mt-8">
                <button onclick="prevReading()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-3 px-4 rounded-lg transition duration-300">ä¸Šä¸€ç¯‡é˜…è¯»</button>
                <button id="reading-check-btn" onclick="checkReading()" class="flex-1 bg-purple-500 hover:bg-purple-600 text-white font-semibold py-3 px-4 rounded-lg transition duration-300">æäº¤é˜…è¯»ç­”æ¡ˆ</button>
                <button onclick="nextReading()" class="flex-1 bg-gray-400 hover:bg-gray-500 text-white font-semibold py-3 px-4 rounded-lg transition duration-300">ä¸‹ä¸€ç¯‡é˜…è¯»</button>
            </div>
            <p id="reading-result" class="text-lg font-medium min-h-[30px] mt-4 text-center"></p>
        </section>

        <section id="section-completion" class="review-section hidden">
            <h2 class="text-2xl font-bold text-gray-700 mb-4">V. å®Œå…¨å¡«ç©º (Sentence Completion)</h2>

            <div class="p-6 bg-pink-50 rounded-xl shadow-lg border border-pink-300 mb-6">
                <p id="completion-cn" class="text-md text-gray-600 font-semibold"></p>
            </div>

            <div class="p-6 bg-white rounded-xl shadow-lg border border-gray-200">
                <p class="text-xl text-gray-800 mb-4 font-medium">æ ¹æ®ä¸­æ–‡æç¤ºï¼Œå¡«å†™æ­£ç¡®çš„å•è¯å®Œæˆå¥å­:</p>
                <div id="completion-quiz-display">
                    </div>
                
                <p id="completion-result" class="text-lg font-medium min-h-[30px] mt-4"></p>
                <div class="flex space-x-4 mt-4">
                    <button onclick="prevCompletion()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-3 px-4 rounded-lg transition duration-300">ä¸Šä¸€é¢˜</button>
                    <button id="completion-check-btn" onclick="checkCompletion()" class="flex-1 bg-pink-500 hover:bg-pink-600 text-white font-semibold py-3 px-4 rounded-lg transition duration-300">æäº¤ç­”æ¡ˆ</button>
                    <button onclick="nextCompletion()" class="flex-1 bg-gray-400 hover:bg-gray-500 text-white font-semibold py-3 px-4 rounded-lg transition duration-300">ä¸‹ä¸€é¢˜</button>
                </div>
            </div>
        </section>

        <section id="section-cloze" class="review-section hidden">
            <h2 class="text-2xl font-bold text-gray-700 mb-4">VI. å®Œå½¢å¡«ç©º (Cloze Test)</h2>

            <div class="p-6 bg-red-50 rounded-xl shadow-lg border border-red-300 mb-6">
                <p id="cloze-title" class="text-xl text-red-800 mb-3 font-bold"></p>
                <div id="cloze-passage" class="cloze-passage-text text-gray-700 mb-4">
                    </div>
                <p class="text-sm text-gray-600">è¯·æ ¹æ®ä¸Šä¸‹æ–‡ï¼Œé€‰æ‹©ä¸‹æ–¹æœ€åˆé€‚çš„é€‰é¡¹å¡«å…¥ç©ºç™½å¤„ã€‚</p>
            </div>

            <div id="cloze-questions-container" class="space-y-6">
                </div>

            <div class="flex space-x-4 mt-8">
                <button onclick="prevCloze()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-3 px-4 rounded-lg transition duration-300">ä¸Šä¸€ç¯‡</button>
                <button id="cloze-check-btn" onclick="checkCloze()" class="flex-1 bg-red-500 hover:bg-red-600 text-white font-semibold py-3 px-4 rounded-lg transition duration-300">æäº¤å®Œå½¢å¡«ç©ºç­”æ¡ˆ</button>
                <button onclick="nextCloze()" class="flex-1 bg-gray-400 hover:bg-gray-500 text-white font-semibold py-3 px-4 rounded-lg transition duration-300">ä¸‹ä¸€ç¯‡</button>
            </div>
            <p id="cloze-result" class="text-lg font-medium min-h-[30px] mt-4 text-center"></p>
        </section>

    </main>

    <script>
        // --- 1. Data Definitions (Unit 2: Where do animals live?) ---

        // æå–è‡ª U2é‡éš¾ç‚¹çº¸å¼ .pdf
        const vocabularyData = [
            // Core Vocabulary
            {en: "eagle", phonetic: "ËˆiËÉ¡l", cn: "è€é¹°", phonics: ["eag", "le"]}, 
            {en: "owl", phonetic: "aÊŠl", cn: "çŒ«å¤´é¹°", phonics: ["owl"]}, 
            {en: "honeybee", phonetic: "ËˆhÊŒnibiË", cn: "èœœèœ‚", phonics: ["ho", "ney", "bee"]},
            {en: "their", phonetic: "Ã°eÉ™r", cn: "ä»–/å¥¹/å®ƒä»¬çš„", phonics: ["their"]}, 
            {en: "tree hole", phonetic: "triË hoÊŠl", cn: "æ ‘æ´", phonics: ["tree", "hole"]}, 
            {en: "nest", phonetic: "nest", cn: "å·¢ç©´", phonics: ["n", "est"]},
            {en: "safe", phonetic: "seÉªf", cn: "å®‰å…¨çš„", phonics: ["s", "afe"]}, 
            {en: "there", phonetic: "Ã°eÉ™r", cn: "é‚£é‡Œ;åœ¨é‚£é‡Œ", phonics: ["th", "ere"]}, 
            {en: "snake", phonetic: "sneÉªk", cn: "è›‡", phonics: ["sn", "ake"]},
            {en: "hive", phonetic: "haÉªv", cn: "èœ‚å·¢", phonics: ["h", "ive"]}, 
            {en: "at night", phonetic: "Ã¦t naÉªt", cn: "æ™šä¸Š", phonics: ["at", "night"]}, 
            {en: "under", phonetic: "ËˆÊŒndÉ™r", cn: "åœ¨â€¦â€¦ä¸‹é¢;å°äº;å°‘äº", phonics: ["un", "der"]},
            {en: "make honey", phonetic: "meÉªk ËˆhÊŒnii", cn: "é…¿èœœ", phonics: ["make", "ho", "ney"]},
            
            // Supplementary Vocabulary
            {en: "goldfish", phonetic: "ËˆÉ¡oÊŠldfÉªÊƒ", cn: "é‡‘é±¼", phonics: ["gold", "fish"]}, 
            {en: "other", phonetic: "ËˆÊŒÃ°É™r", cn: "å…¶å®ƒçš„", phonics: ["o", "ther"]}, 
            {en: "come out", phonetic: "kÊŒm aÊŠt", cn: "å‡ºæ¥", phonics: ["come", "out"]},
            {en: "baby eagle", phonetic: "ËˆbeÉªbi ËˆiËÉ¡l", cn: "é›é¹°", phonics: ["baby", "eag", "le"]}, 
            {en: "pond", phonetic: "pÉ‘Ënd", cn: "æ± å¡˜", phonics: ["p", "ond"]}, 
            {en: "panda centre", phonetic: "ËˆpÃ¦ndÉ™ ËˆsentÉ™r", cn: "ç†ŠçŒ«ä¸­å¿ƒ", phonics: ["pan", "da", "cen", "tre"]},
            {en: "take care of", phonetic: "teÉªk ker É™v", cn: "ç…§é¡¾", phonics: ["take", "care", "of"]}, 
            {en: "up in a tree", phonetic: "ÊŒp Éªn É™ triË", cn: "åœ¨æ ‘ä¸Š", phonics: ["up", "in", "a", "tree"]},
            {en: "in the wild", phonetic: "Éªn Ã°É™ waÉªld", cn: "åœ¨é‡å¤–", phonics: ["in", "the", "wild"]},
            {en: "amazing", phonetic: "É™ËˆmeÉªzÉªÅ‹", cn: "ä»¤äººæƒŠå¥‡çš„", phonics: ["a", "maz", "ing"]},
        ];

        // æå–è‡ª U2é‡éš¾ç‚¹çº¸å¼ .pdf
        const sentenceData = [
            {en: "Eagles live in big nests.", cn: "è€é¹°ä½åœ¨å¤§çš„å·¢ç©´é‡Œã€‚"},
            {en: "Where are their nests?", cn: "å®ƒä»¬çš„çªåœ¨å“ªé‡Œ?"},
            {en: "They are in the trees.", cn: "å®ƒä»¬åœ¨æ ‘ä¸Šã€‚"},
            {en: "Some eagles are white and brown.", cn: "ä¸€äº›è€é¹°æ˜¯ç™½è‰²å’Œæ£•è‰²çš„ã€‚"},
            {en: "They eat rabbits, frogs and birds.", cn: "å®ƒä»¬åƒå…”å­ã€é’è›™å’Œé¸Ÿã€‚"},
            {en: "Where do owls live?", cn: "çŒ«å¤´é¹°ä»¬ä½åœ¨å“ªé‡Œ?"},
            {en: "They live in tree holes.", cn: "å®ƒä»¬ä½åœ¨æ ‘æ´é‡Œã€‚"},
            {en: "They are safe there.", cn: "å®ƒä»¬åœ¨é‚£é‡Œå¾ˆå®‰å…¨ã€‚"},
            {en: "Owls come out at night.", cn: "çŒ«å¤´é¹°æ™šä¸Šå‡ºæ¥(æ´»åŠ¨)ã€‚"},
            {en: "They eat mice and snakes.", cn: "å®ƒä»¬æ•é£Ÿè€é¼ å’Œè›‡ã€‚"},
            {en: "Honeybees live in a hive.", cn: "èœœèœ‚ä»¬ä½åœ¨èœ‚å·¢ä¸­ã€‚"},
            {en: "There, they make honey.", cn: "åœ¨é‚£é‡Œ,å®ƒä»¬é…¿é€ èœ‚èœœã€‚"},
            {en: "They have food in winter.", cn: "å®ƒä»¬åœ¨å†¬å¤©æœ‰äº†é£Ÿç‰©ã€‚"},
            {en: "Honeybees have five eyes.", cn: "èœœèœ‚æœ‰äº”åªçœ¼ç›ã€‚"},
            {en: "They can't see the colour red.", cn: "å®ƒä»¬æ— æ³•è¾¨è¯†çº¢è‰²ã€‚"},
            {en: "A panda mum has a baby in a panda centre.", cn: "ä¸€åªç†ŠçŒ«å¦ˆå¦ˆåœ¨ç†ŠçŒ«ä¸­å¿ƒç”Ÿäº†ä¸€åªå®å®ã€‚"},
            {en: "People take care of him.", cn: "äººä»¬ç²¾å¿ƒç…§é¡¾ä»–ã€‚"},
            {en: "They call him Taotao.", cn: "ä»–ä»¬å«ä»–æ·˜æ·˜ã€‚"},
            {en: "Taotao is one year old.", cn: "æ·˜æ·˜ä¸€å²äº†ã€‚"},
            {en: "He loves his mum.", cn: "ä»–çˆ±ä»–çš„å¦ˆå¦ˆã€‚"},
            {en: "Wow! Taotao is now a big strong panda.", cn: "å“‡!æ·˜æ·˜ç°åœ¨æ˜¯ä¸€åªé«˜å¤§å¼ºå£®çš„ç†ŠçŒ«äº†ã€‚"},
            {en: "Where is Taotao?", cn: "æ·˜æ·˜åœ¨å“ªé‡Œ?"},
            {en: "He is up in a tree.", cn: "ä»–åœ¨ä¸€æ£µé«˜é«˜çš„æ ‘ä¸Šã€‚"},
            {en: "Taotao now lives in the wild.", cn: "æ·˜æ·˜ç°åœ¨ç”Ÿæ´»åœ¨é‡å¤–ã€‚"},
            {en: "That is amazing!", cn: "é‚£çœŸæ˜¯å¤ªæ£’äº†!"},
            // Grammar example sentences from U2é‡éš¾ç‚¹çº¸å¼ .pdf
            {en: "Where is Ms Fang? (She's in the office.)", cn: "è¯¢é—®å•ä¸ªçš„äººç‰©åœ¨å“ªé‡Œ (Where is...?)"},
            {en: "Where's my bread/apple? (It's on the table.)", cn: "è¯¢é—®å•ä¸ªç‰©å“æˆ–ä¸å¯æ•°ç‰©å“åœ¨å“ªé‡Œ (Where's...?)"},
            {en: "Where are the honeybees? (They are / They're in the hive.)", cn: "è¯¢é—®å¤æ•°ç‰©å“åœ¨å“ªé‡Œ (Where are...?)"},
        ];

        // è¯­æ³•è‡ªæµ‹ (Where is/are, åè¯æ‰€æœ‰æ ¼, åŠ¨ç‰©å±…ä½åœ°) æå–è‡ª U2é‡éš¾ç‚¹çº¸å¼ .pdf
        const grammarQuizData = [
            // Where is/are
            { type: 'where', sentence: ["Where", "[be_sg]", "Taotao? He", "[be_sg]", "up in a tree."], blanks: [{ base: "is", correct: "is"}, { base: "is", correct: "is"}], cn: "æ·˜æ·˜åœ¨å“ªé‡Œ? ä»–åœ¨ä¸€æ£µé«˜é«˜çš„æ ‘ä¸Šã€‚", rule: "è¯¢é—®å•æ•°äºº/ç‰©ç”¨ Where is..., å›ç­”ç”¨ He/She/It is..."},
            { type: 'where', sentence: ["Where", "[be_pl]", "their nests? They", "[be_pl]", "in the trees."], blanks: [{ base: "are", correct: "are"}, { base: "are", correct: "are"}], cn: "å®ƒä»¬çš„çªåœ¨å“ªé‡Œ? å®ƒä»¬åœ¨æ ‘ä¸Šã€‚", rule: "è¯¢é—®å¤æ•°äºº/ç‰©ç”¨ Where are..., å›ç­”ç”¨ They are..."},
            // Live/Be verb
            { type: 'live', sentence: ["Owls", "[verb_pl]", "in tree holes. They", "[be_pl]", "safe there."], blanks: [{ base: "live", correct: "live"}, { base: "are", correct: "are"}], cn: "çŒ«å¤´é¹°ä»¬ä½åœ¨æ ‘æ´é‡Œã€‚å®ƒä»¬åœ¨é‚£é‡Œå¾ˆå®‰å…¨ã€‚", rule: "åŠ¨è¯ live çš„å¤æ•°å½¢å¼ä¸º live; They are..."},
            // Possessive (Singular)
            { type: 'possessive', sentence: ["The", "[eagle_pos]", "home is big."], blanks: [{ base: "eagle's", correct: "eagle's"}], cn: "è€é¹°çš„å®¶æ˜¯å¤§çš„ã€‚", rule: "å•æ•°åè¯æ‰€æœ‰æ ¼åŠ  'sã€‚"},
            // Possessive (Plural -s)
            { type: 'possessive', sentence: ["The", "[animal_pos]", "homes are safe."], blanks: [{ base: "animals'", correct: "animals'"}], cn: "åŠ¨ç‰©ä»¬çš„å®¶æ˜¯å®‰å…¨çš„ã€‚", rule: "ä»¥-sç»“å°¾çš„å¤æ•°åè¯æ‰€æœ‰æ ¼åŠ  'ã€‚"},
            // Animal Habitats & Live
            { type: 'live', sentence: ["Fish", "[verb_pl]", "in the water. Frogs", "[verb_pl]", "in ponds."], blanks: [{ base: "live", correct: "live"}, { base: "live", correct: "live"}], cn: "é±¼ä½åœ¨æ°´é‡Œã€‚é’è›™ä½åœ¨æ± å¡˜é‡Œã€‚", rule: "åŠ¨ç‰©å±…ä½åœ°æ€»ç»“ï¼šFish/Frogs live in/on..."},
            // Possessive (Shared)
            { type: 'possessive', sentence: ["[Lily_Lucy_s]", "room is small."], blanks: [{ base: "Lily and Lucy's", correct: "Lily and Lucy's"}], cn: "è‰è‰å’Œéœ²è¥¿çš„æˆ¿é—´å¾ˆå°ã€‚", rule: "ä¸¤äººå…±åŒæ‹¥æœ‰æŸç‰©æ—¶ï¼Œåœ¨æœ€åä¸€ä¸ªåå­—ååŠ 'sã€‚"},
        ];
        
        // é˜…è¯»ç†è§£ (åŸºäºã€ŠTaotaoç†ŠçŒ«ã€‹æ•…äº‹) æå–è‡ª U2é‡éš¾ç‚¹çº¸å¼ .pdf
        const readingQuizData = [
            {
                title: "Passage 1: Taotao the Panda",
                text: "A panda mum has a baby in a panda centre. People take care of him. They call him Taotao. Taotao is one year old. He loves his mum. Wow! Taotao is now a big strong panda. Where is Taotao? He is up in a tree. Taotao now lives in the wild. That is amazing!",
                questions: [
                    {
                        q: "Where did Taotao's mum have the baby?",
                        options: ["In the wild.", "In a tree.", "In a panda centre.", "In a pond."],
                        correct: 2, // In a panda centre.
                    },
                    {
                        q: "What is Taotao doing now?",
                        options: ["He is one year old.", "He loves his mum.", "He is up in a tree.", "He lives in a hive."],
                        correct: 2, // He is up in a tree.
                    },
                    {
                        q: "Where does Taotao live now?",
                        options: ["In a panda centre.", "In the wild.", "In a nest.", "In a tree hole."],
                        correct: 1, // In the wild.
                    },
                ]
            }
        ];

        // å®Œå…¨å¡«ç©º (Sentence Completion) æå–è‡ª U2é‡éš¾ç‚¹çº¸å¼ .pdf
        const completionQuizData = [
            { cn: "è€é¹°ä½åœ¨å¤§çš„å·¢ç©´é‡Œã€‚", en_parts: ["**[Eagles]**", "live in big", "**[nests]**", "."], blanks: [{ correct: "Eagles" }, { correct: "nests" }] },
            { cn: "å®ƒä»¬åœ¨é‚£é‡Œå¾ˆå®‰å…¨ã€‚", en_parts: ["They are", "**[safe]**", "**[there]**", "."], blanks: [{ correct: "safe" }, { correct: "there" }] },
            { cn: "èœœèœ‚ä»¬é…¿é€ èœ‚èœœã€‚", en_parts: ["Honeybees", "**[make]**", "**[honey]**", "."], blanks: [{ correct: "make" }, { correct: "honey" }] },
            { cn: "å®ƒä»¬æ™šä¸Šå‡ºæ¥æ´»åŠ¨ã€‚", en_parts: ["Owls", "**[come]**", "out", "**[at]**", "**[night]**", "."], blanks: [{ correct: "come" }, { correct: "at" }, { correct: "night" }] },
            { cn: "ç†ŠçŒ«ä¸­å¿ƒçš„äººä»¬ç²¾å¿ƒç…§é¡¾ä»–ã€‚", en_parts: ["People", "**[take]**", "**[care]**", "of him in the panda", "**[centre]**", "."], blanks: [{ correct: "take" }, { correct: "care" }, { correct: "centre" }] },
            { cn: "æ·˜æ·˜ç°åœ¨æ˜¯ä¸€åªé«˜å¤§å¼ºå£®çš„ç†ŠçŒ«äº†ã€‚", en_parts: ["Taotao is now a", "**[big]**", "**[strong]**", "**[panda]**", "."], blanks: [{ correct: "big" }, { correct: "strong" }, { correct: "panda" }] },
        ];

        // å®Œå½¢å¡«ç©º (Cloze Test) æå–è‡ª U2é‡éš¾ç‚¹çº¸å¼ .pdf
        const clozeQuizData = [
            {
                title: "Animals' Homes and Facts",
                textParts: [ 
                    "Eagles ", "live", // (1) 
                    " in big nests. Their nests are ", "up", // (2) 
                    " in a tree. Owls ", "live", // (3) 
                    " in tree ", "holes", // (4) 
                    ". They come out ", "at", // (5) 
                    " night. Honeybees live in a ", "hive", // (6) 
                    ". There, they ", "make", // (7) 
                    " honey. They have ", "five", // (8) 
                    " eyes and they can't see the colour ", "red", // (9) 
                    ". Rabbits live in ", "caves", // (10) 
                    " and fish live in the water."
                ],
                questions: [
                    { qIndex: 1, options: ["live", "lives", "living", "lived"], correct: 0 }, // live (Eagles live)
                    { qIndex: 2, options: ["on", "in", "under", "up"], correct: 3 }, // up (up in a tree)
                    { qIndex: 3, options: ["live", "lives", "living", "lived"], correct: 0 }, // live (Owls live)
                    { qIndex: 4, options: ["nests", "holes", "houses", "flats"], correct: 1 }, // holes (tree holes)
                    { qIndex: 5, options: ["on", "in", "at", "by"], correct: 2 }, // at (at night)
                    { qIndex: 6, options: ["nest", "hive", "home", "flat"], correct: 1 }, // hive (in a hive)
                    { qIndex: 7, options: ["making", "make", "makes", "made"], correct: 1 }, // make (they make)
                    { qIndex: 8, options: ["four", "five", "six", "seven"], correct: 1 }, // five (five eyes)
                    { qIndex: 9, options: ["blue", "red", "yellow", "green"], correct: 1 }, // red (colour red)
                    { qIndex: 10, options: ["nests", "caves", "ponds", "tree holes"], correct: 1 }, // caves (Rabbits live in caves)
                ]
            }
        ];

        // --- 2. State Variables ---
        let currentVocabIndex = 0;
        let isVocabFlipped = false;
        let showChineseTranslation = true; // æ–°å¢çŠ¶æ€ï¼šæ§åˆ¶ä¸­æ–‡ç¿»è¯‘æ˜¾ç¤º
        let currentSentenceIndex = 0;
        let currentGrammarIndex = 0;
        let currentReadingIndex = 0;
        let currentCompletionIndex = 0;
        let currentClozeIndex = 0;

        // Shuffle quiz data for variety
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Shuffle all quizzes to make them less predictable
        shuffleArray(grammarQuizData);
        shuffleArray(completionQuizData);
        // Do NOT shuffle Reading/Cloze if there's only one, as it breaks prev/next logic easily

        // --- TTS & Audio Logic (Fixed to use browser native for better compatibility) ---
        function playAudio(text) {
            const statusEl = document.getElementById('audio-status');
            try {
                if ('speechSynthesis' in window) {
                    statusEl.textContent = 'ğŸ”Š æ­£åœ¨æ’­æ”¾ (æµè§ˆå™¨è¯­éŸ³)...';
                    statusEl.classList.remove('text-red-500', 'text-gray-500');
                    statusEl.classList.add('text-indigo-500');

                    // Stop any ongoing speech
                    window.speechSynthesis.cancel();
                    const ut = new SpeechSynthesisUtterance(text);
                    ut.lang = 'en-US'; // Use English voice

                    // Attempt to find a suitable voice
                    const voices = window.speechSynthesis.getVoices();
                    const enVoice = voices.find(voice => voice.lang.startsWith('en-'));
                    if (enVoice) {
                        ut.voice = enVoice;
                    }

                    ut.onend = () => {
                        statusEl.textContent = 'ç‚¹å‡»è¯»éŸ³æŒ‰é’®æ’­æ”¾';
                        statusEl.classList.replace('text-indigo-500', 'text-gray-500');
                    };
                    ut.onerror = (event) => {
                        console.error('SpeechSynthesisError: ', event.error);
                        statusEl.textContent = 'âŒ è¯»éŸ³å¤±è´¥';
                        statusEl.classList.replace('text-indigo-500', 'text-red-500');
                    };

                    window.speechSynthesis.speak(ut);
                    return;
                }
            } catch (e) {
                console.warn("Browser Speech Synthesis failed:", e);
            }

            // Fallback message
            statusEl.textContent = 'ğŸ”Š è¯»éŸ³ä¸å¯ç”¨ (æ— è¯­éŸ³åŠŸèƒ½)';
            statusEl.classList.replace('text-indigo-500', 'text-red-500');
            setTimeout(() => {
                statusEl.textContent = 'ç‚¹å‡»è¯»éŸ³æŒ‰é’®æ’­æ”¾';
                statusEl.classList.replace('text-red-500', 'text-gray-500');
            }, 3000);
        }


        // --- 3. UI/Navigation Logic ---

        // Function to update visibility of Chinese elements based on toggle state
        function updateContentVisibility(isVisible) {
            // This function is mainly for the Vocab card back, but can be extended if needed
            const cardBack = document.getElementById('vocab-card-back-cn');
            if (cardBack) {
                cardBack.style.display = isVisible ? 'flex' : 'none';
            }
        }


        window.showSection = function(sectionId) {
            // Hide all sections
            document.querySelectorAll('.review-section').forEach(section => {
                section.classList.add('hidden');
            });
            // Show the selected section
            document.getElementById(`section-${sectionId}`).classList.remove('hidden');

            // Update tab styles
            document.querySelectorAll('button[id^="tab-"]').forEach(tab => {
                tab.classList.remove('tab-active');
            });
            document.getElementById(`tab-${sectionId}`).classList.add('tab-active');

            // Re-render current content on tab change
            if (sectionId === 'vocab') {
                renderVocabCard();
            } else if (sectionId === 'sentences') {
                renderSentence();
            } else if (sectionId === 'grammar') {
                renderGrammarQuiz();
            } else if (sectionId === 'reading') {
                renderReadingQuiz();
            } else if (sectionId === 'completion') {
                renderCompletionQuiz();
            } else if (sectionId === 'cloze') {
                renderClozeQuiz();
            }
            
            // Apply CN visibility based on current toggle state
            updateContentVisibility(showChineseTranslation);
        }

        // --- 4. Vocabulary Flashcard Logic ---
        window.toggleChinese = function() { // Made global for onclick
            // Read the checked state of the toggle switch
            showChineseTranslation = document.getElementById('chinese-toggle').checked;
            updateContentVisibility(showChineseTranslation);
        }

        function renderVocabCard() {
            const container = document.getElementById('vocab-card-container');
            const data = vocabularyData[currentVocabIndex];

            // Generate phonics breakdown HTML
            const phonicsHtml = data.phonics.map(p => `<span>${p}</span>`).join('');

            // Update counter
            document.getElementById('vocab-counter').textContent = `${currentVocabIndex + 1} / ${vocabularyData.length}`;

            // Determine Chinese visibility for the back side
            const chineseDisplay = showChineseTranslation ? 'flex' : 'none';

            // Create card HTML
            container.innerHTML = `
                <div id="vocab-card" class="flashcard ${isVocabFlipped ? 'flipped' : ''}" onclick="flipVocab()">
                    <div class="flashcard-inner">
                        <div class="flashcard-front">
                            <div class="flex flex-col items-center p-4">
                                <span class="text-3xl font-bold mb-1">${data.en}</span>
                                <span class="text-xl font-medium mb-1 text-white/80">[${data.phonetic}]</span>
                                <div class="phonics-breakdown flex justify-center flex-wrap">${phonicsHtml}</div>
                                <button onclick="event.stopPropagation(); playAudio('${data.en}')" class="bg-white text-indigo-600 hover:bg-indigo-100 p-2 rounded-full mt-4 shadow-lg transition duration-150">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.454-9.526a9 9 0 010 12.728M21 12a12.01 12.01 0 01-14.735 6.84A12.001 12.001 0 013 12a12.001 12.001 0 013.265-4.84 12.01 12.01 0 0115 4.84V12z" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div id="vocab-card-back-cn" class="flashcard-back" style="display: ${chineseDisplay};">
                            <span class="text-2xl font-bold text-gray-800">${data.cn}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        window.flipVocab = function() {
            isVocabFlipped = !isVocabFlipped;
            document.getElementById('vocab-card').classList.toggle('flipped', isVocabFlipped);
        }

        window.nextVocab = function() {
            currentVocabIndex = (currentVocabIndex + 1) % vocabularyData.length;
            isVocabFlipped = false;
            renderVocabCard();
        }

        window.prevVocab = function() {
            currentVocabIndex = (currentVocabIndex - 1 + vocabularyData.length) % vocabularyData.length;
            isVocabFlipped = false;
            renderVocabCard();
        }

        // --- 5. Sentence Review Logic (II) ---
        function renderSentence() {
            const data = sentenceData[currentSentenceIndex];

            document.getElementById('sentence-counter').textContent = `${currentSentenceIndex + 1} / ${sentenceData.length}`;

            // Reset state
            document.getElementById('sentence-cn').textContent = data.cn;
            document.getElementById('sentence-en').textContent = data.en;
            document.getElementById('sentence-en-container').classList.add('hidden');
            document.getElementById('sentence-reveal-btn').textContent = "ç‚¹å‡»æ˜¾ç¤ºè‹±æ–‡åŸå¥";
            document.getElementById('sentence-reveal-btn').classList.remove('bg-gray-500');
            document.getElementById('sentence-reveal-btn').classList.add('bg-emerald-500');
            
            updateContentVisibility(showChineseTranslation);
        }

        function revealSentence() {
            document.getElementById('sentence-en-container').classList.remove('hidden');
            document.getElementById('sentence-reveal-btn').textContent = "å·²æ˜¾ç¤º - ç‚¹å‡»ä¸‹ä¸€å¥";
            document.getElementById('sentence-reveal-btn').classList.remove('bg-emerald-500');
            document.getElementById('sentence-reveal-btn').classList.add('bg-gray-500');
            document.getElementById('sentence-reveal-btn').onclick = nextSentence;
        }

        function nextSentence() {
            currentSentenceIndex = (currentSentenceIndex + 1) % sentenceData.length;
            document.getElementById('sentence-reveal-btn').onclick = revealSentence;
            renderSentence();
        }

        function prevSentence() {
            currentSentenceIndex = (currentSentenceIndex - 1 + sentenceData.length) % sentenceData.length;
            document.getElementById('sentence-reveal-btn').onclick = revealSentence;
            renderSentence();
        }

        // --- 6. Grammar Quiz Logic (III) ---
        function renderGrammarQuiz() {
            const data = grammarQuizData[currentGrammarIndex];
            const quizDisplay = document.getElementById('grammar-quiz-display');
            const result = document.getElementById('quiz-result');

            // Display rule hint and CN hint
            document.getElementById('grammar-rule').textContent = data.rule;
            document.getElementById('grammar-cn').textContent = `ä¸­æ–‡: ${data.cn}`;

            // Reset state
            result.textContent = '';
            document.getElementById('check-btn').style.display = 'block';

            // Build the sentence display with blanks
            let html = '';
            let blankCounter = 0;
            data.sentence.forEach(part => {
                if (part.startsWith('[')) { // It's a blank
                    const baseWord = data.blanks[blankCounter].base;
                    html += `
                        <input type="text" class="border-2 border-gray-300 p-2 rounded-lg text-center focus:border-orange-500 focus:ring-orange-500" data-correct="${data.blanks[blankCounter].correct.toLowerCase()}" placeholder="${baseWord}" title="å¡«å†™æ­£ç¡®çš„è¯å½¢" maxlength="20" >
                    `;
                    blankCounter++;
                } else {
                    html += `<span>${part}</span>`;
                }
            });

            quizDisplay.innerHTML = html;
            updateContentVisibility(showChineseTranslation);
        }

        function checkGrammar() {
            const data = grammarQuizData[currentGrammarIndex];
            const quizDisplay = document.getElementById('grammar-quiz-display');
            const inputs = quizDisplay.querySelectorAll('input');
            const result = document.getElementById('quiz-result');
            let allCorrect = true;

            inputs.forEach((input, index) => {
                const userAnswer = input.value.trim().toLowerCase();
                const correctWord = input.dataset.correct.toLowerCase();
                
                input.disabled = true;

                if (userAnswer === correctWord) {
                    input.classList.add('border-green-500');
                    input.classList.remove('border-red-500', 'border-gray-300');
                    input.classList.remove('bg-fffbeb'); // Remove quiz background color
                    input.classList.add('bg-green-50'); // Add success background
                } else {
                    input.classList.add('border-red-500');
                    input.classList.remove('border-green-500', 'border-gray-300');
                    input.classList.remove('bg-fffbeb');
                    input.classList.add('bg-red-50');
                    allCorrect = false;
                }
            });

            // Construct and display the full correct sentence
            let finalSentenceParts = [];
            let blankCounter = 0;
            data.sentence.forEach(part => {
                if (part.startsWith('[')) {
                    finalSentenceParts.push(data.blanks[blankCounter].correct);
                    blankCounter++;
                } else {
                    finalSentenceParts.push(part);
                }
            });
            const fullCorrectSentence = finalSentenceParts.join(' ');


            if (allCorrect) {
                result.innerHTML = `<span class="text-green-600">âœ… å…¨éƒ¨æ­£ç¡®ï¼</span> <span class="text-yellow-800">å®Œæ•´å¥å­ï¼š${fullCorrectSentence}</span>`;
            } else {
                result.innerHTML = `<span class="text-red-600">âŒ å­˜åœ¨é”™è¯¯ã€‚</span> <span class="text-yellow-800">æ­£ç¡®å¥å­: ${fullCorrectSentence}</span>`;
            }

            document.getElementById('check-btn').style.display = 'none';
        }

        function nextGrammar() {
            currentGrammarIndex = (currentGrammarIndex + 1) % grammarQuizData.length;
            renderGrammarQuiz();
        }

        function prevGrammar() {
            currentGrammarIndex = (currentGrammarIndex - 1 + grammarQuizData.length) % grammarQuizData.length;
            renderGrammarQuiz();
        }

        // --- 7. Reading Quiz Logic (IV) ---
        function renderReadingQuiz() {
            const data = readingQuizData[currentReadingIndex];

            document.getElementById('reading-title').textContent = data.title;
            document.getElementById('reading-passage').textContent = data.text;
            document.getElementById('reading-result').textContent = '';
            document.getElementById('reading-check-btn').style.display = 'block';

            const questionsContainer = document.getElementById('reading-questions-container');
            let html = '';

            data.questions.forEach((qItem, qIndex) => {
                html += `
                    <div class="p-4 bg-white rounded-lg shadow-sm border border-purple-200">
                        <p class="font-bold mb-3 text-gray-800">${qIndex + 1}. ${qItem.q}</p>
                        <div class="space-y-2">
                `;
                qItem.options.forEach((option, oIndex) => {
                    html += `
                        <label class="flex items-center space-x-2 text-gray-700 cursor-pointer hover:bg-purple-50 p-2 rounded-md transition duration-150">
                            <input type="radio" name="q${qIndex}" value="${oIndex}" class="text-purple-600 focus:ring-purple-500" data-qindex="${qIndex}">
                            <span>${String.fromCharCode(65 + oIndex)}. ${option}</span>
                        </label>
                    `;
                });
                html += `
                        </div>
                        <p id="q-result-${qIndex}" class="mt-2 text-sm font-semibold"></p>
                    </div>
                `;
            });

            questionsContainer.innerHTML = html;
        }

        function checkReading() {
            const data = readingQuizData[currentReadingIndex];
            let score = 0;
            let total = data.questions.length;

            data.questions.forEach((qItem, qIndex) => {
                const selected = document.querySelector(`input[name="q${qIndex}"]:checked`);
                const resultEl = document.getElementById(`q-result-${qIndex}`);

                // Disable all options for this question
                document.querySelectorAll(`input[name="q${qIndex}"]`).forEach(input => {
                    input.disabled = true;
                    // Visually mark labels
                    const label = input.closest('label');
                    if (label) label.classList.remove('hover:bg-purple-50', 'cursor-pointer');
                });

                if (selected) {
                    const userAnswer = parseInt(selected.value);
                    if (userAnswer === qItem.correct) {
                        score++;
                        resultEl.innerHTML = '<span class="text-green-600">âœ… æ­£ç¡®</span>';
                        selected.closest('label').classList.add('bg-green-100');
                    } else {
                        const correctOption = String.fromCharCode(65 + qItem.correct);
                        resultEl.innerHTML = `<span class="text-red-600">âŒ é”™è¯¯</span> (æ­£ç¡®ç­”æ¡ˆ: ${correctOption}. ${qItem.options[qItem.correct]})`;
                        selected.closest('label').classList.add('bg-red-100');
                        // Highlight correct answer
                        const correctInput = document.querySelector(`input[name="q${qIndex}"][value="${qItem.correct}"]`);
                        if (correctInput) {
                            correctInput.closest('label').classList.add('bg-green-50', 'border-2', 'border-green-400');
                        }
                    }
                } else {
                    resultEl.innerHTML = '<span class="text-yellow-600">âš ï¸ æœªä½œç­”</span>';
                    // Highlight correct answer
                    const correctOption = String.fromCharCode(65 + qItem.correct);
                    const correctInput = document.querySelector(`input[name="q${qIndex}"][value="${qItem.correct}"]`);
                    if (correctInput) {
                        correctInput.closest('label').classList.add('bg-green-50', 'border-2', 'border-green-400');
                    }
                }
            });

            document.getElementById('reading-result').textContent = `å¾—åˆ†: ${score} / ${total}`;
            document.getElementById('reading-check-btn').style.display = 'none';
        }

        function nextReading() {
            currentReadingIndex = (currentReadingIndex + 1) % readingQuizData.length;
            renderReadingQuiz();
        }

        function prevReading() {
            currentReadingIndex = (currentReadingIndex - 1 + readingQuizData.length) % readingQuizData.length;
            renderReadingQuiz();
        }


        // --- 8. Completion Quiz Logic (V) ---
        function renderCompletionQuiz() {
            const data = completionQuizData[currentCompletionIndex];
            const quizDisplay = document.getElementById('completion-quiz-display');
            const result = document.getElementById('completion-result');

            // Display CN hint
            document.getElementById('completion-cn').textContent = `ä¸­æ–‡: ${data.cn}`;

            // Reset state
            result.textContent = '';
            document.getElementById('completion-check-btn').style.display = 'block';

            // Build the sentence display with blanks
            let html = '';
            let blankCounter = 0;
            data.en_parts.forEach(part => {
                // The blank markers are in the data structure, not the input type
                if (part.startsWith('**[')) { // It's a blank
                    const correctWord = data.blanks[blankCounter].correct;
                    // Use the first letter of the correct word as a hint/placeholder
                    const placeholderHint = correctWord.charAt(0).toUpperCase() + '...';
                    
                    html += `
                        <input type="text" class="border-2 border-gray-300 p-2 rounded-lg text-center focus:border-pink-500 focus:ring-pink-500" data-correct="${correctWord.toLowerCase()}" placeholder="${placeholderHint}" title="è¯·å¡«å†™å®Œæ•´çš„å•è¯" maxlength="20" >
                    `;
                    blankCounter++;
                } else {
                    html += `<span>${part.replace(/\[|\]|\*\*/g, '')}</span>`;
                }
            });

            quizDisplay.innerHTML = html;
            updateContentVisibility(showChineseTranslation);
        }

        function checkCompletion() {
            const data = completionQuizData[currentCompletionIndex];
            const quizDisplay = document.getElementById('completion-quiz-display');
            const inputs = quizDisplay.querySelectorAll('input');
            const result = document.getElementById('completion-result');
            let allCorrect = true;

            inputs.forEach((input, index) => {
                const userAnswer = input.value.trim().toLowerCase();
                const correctWord = input.dataset.correct.toLowerCase();
                
                input.disabled = true;

                if (userAnswer === correctWord) {
                    input.classList.add('border-green-500');
                    input.classList.remove('border-red-500', 'border-gray-300');
                    input.classList.remove('bg-fffbeb');
                    input.classList.add('bg-green-50');
                } else {
                    input.classList.add('border-red-500');
                    input.classList.remove('border-green-500', 'border-gray-300');
                    input.classList.remove('bg-fffbeb');
                    input.classList.add('bg-red-50');
                    allCorrect = false;
                }
            });

            // Construct and display the full correct sentence
            let finalSentenceParts = [];
            let blankCounter = 0;
            data.en_parts.forEach(part => {
                if (part.startsWith('**[')) {
                    finalSentenceParts.push(data.blanks[blankCounter].correct);
                    blankCounter++;
                } else {
                    finalSentenceParts.push(part.replace(/\[|\]|\*\*/g, ''));
                }
            });
            const fullCorrectSentence = finalSentenceParts.join(' ').trim();


            if (allCorrect) {
                result.innerHTML = `<span class="text-green-600">âœ… å…¨éƒ¨æ­£ç¡®ï¼</span> <span class="text-pink-800">å®Œæ•´å¥å­ï¼š${fullCorrectSentence}</span>`;
            } else {
                result.innerHTML = `<span class="text-red-600">âŒ å­˜åœ¨é”™è¯¯ã€‚</span> <span class="text-pink-800">æ­£ç¡®å¥å­: ${fullCorrectSentence}</span>`;
            }

            document.getElementById('completion-check-btn').style.display = 'none';
        }

        function nextCompletion() {
            currentCompletionIndex = (currentCompletionIndex + 1) % completionQuizData.length;
            renderCompletionQuiz();
        }

        function prevCompletion() {
            currentCompletionIndex = (currentCompletionIndex - 1 + completionQuizData.length) % completionQuizData.length;
            renderCompletionQuiz();
        }

        // --- 9. Cloze Test Logic (VI) ---
        function renderClozeQuiz() {
            const data = clozeQuizData[currentClozeIndex];
            document.getElementById('cloze-title').textContent = data.title;
            document.getElementById('cloze-result').textContent = '';
            document.getElementById('cloze-check-btn').style.display = 'block';

            // 1. Render Passage
            const passageEl = document.getElementById('cloze-passage');
            let passageHtml = '';
            
            // Combine all text and blanks first, adding &nbsp; around blanks to prevent wrapping.
            const fullTextWithBlanks = data.textParts.reduce((acc, part, index) => {
                // If index is odd (1, 3, 5...), it's a blank word (e.g., "live", "up")
                if (index % 2 !== 0) {
                    const qNum = (index + 1) / 2;
                    acc += `<span class="cloze-placeholder" id="cloze-placeholder-${qNum}">
                                <span class="cloze-number">${qNum}</span>
                                <span class="cloze-underline"></span>
                            </span>&nbsp;`;
                } else {
                    // If index is even (0, 2, 4...), it's regular text
                    acc += part.trim() + '&nbsp;';
                }
                return acc;
            }, '');
            passageEl.innerHTML = fullTextWithBlanks;

            // 2. Render Questions
            const questionsContainer = document.getElementById('cloze-questions-container');
            let questionsHtml = '';

            data.questions.forEach((qItem, index) => {
                const qNum = qItem.qIndex;
                questionsHtml += `
                    <div class="p-4 bg-white rounded-lg shadow-sm border border-red-200">
                        <p class="font-bold mb-3 text-gray-800">(${qNum}) è¯·é€‰æ‹©æ­£ç¡®çš„è¯æ±‡:</p>
                        <div class="cloze-options-row" id="cloze-options-row-${qNum}">
                `;
                qItem.options.forEach((option, oIndex) => {
                    questionsHtml += `
                        <label>
                            <input type="radio" name="cloze-q${qNum}" value="${oIndex}" data-qindex="${qNum}">
                            <span>${String.fromCharCode(65 + oIndex)}. ${option}</span>
                        </label>
                    `;
                });
                questionsHtml += `
                        </div>
                        <p id="cloze-q-result-${qNum}" class="mt-2 text-sm font-semibold"></p>
                    </div>
                `;
            });
            questionsContainer.innerHTML = questionsHtml;
        }

        function checkCloze() {
            const data = clozeQuizData[currentClozeIndex];
            let score = 0;
            let total = data.questions.length;

            data.questions.forEach((qItem) => {
                const qNum = qItem.qIndex;
                const selected = document.querySelector(`input[name="cloze-q${qNum}"]:checked`);
                const resultEl = document.getElementById(`cloze-q-result-${qNum}`);
                const placeholderEl = document.getElementById(`cloze-placeholder-${qNum}`);

                // The correct word is stored in textParts at index (qNum * 2 - 1)
                const correctWord = data.textParts[qNum * 2 - 1];
                let correct = false;

                // Disable all options and update visual for the current question
                document.querySelectorAll(`input[name="cloze-q${qNum}"]`).forEach(input => {
                    input.disabled = true;
                    // Visually mark labels
                    const label = input.closest('label');
                    if (label) label.classList.remove('hover:bg-red-50', 'cursor-pointer', 'border-red-400');

                    const isCorrectOption = parseInt(input.value) === qItem.correct;

                    if (selected && parseInt(selected.value) === parseInt(input.value)) {
                        // User's selection
                        if (isCorrectOption) {
                            label.classList.add('bg-green-100', 'border-green-400', 'border-2');
                        } else {
                            label.classList.add('bg-red-100', 'border-red-400', 'border-2');
                        }
                    } else if (isCorrectOption) {
                        // Correct option (not selected by user, or user selected but for visual cue)
                        label.classList.add('bg-green-50', 'border-green-400', 'border-2');
                    }
                });

                if (selected) {
                    const userAnswer = parseInt(selected.value);
                    if (userAnswer === qItem.correct) {
                        score++;
                        correct = true;
                    }
                }

                if (correct) {
                    resultEl.innerHTML = `<span class="text-green-600">âœ… æ­£ç¡®</span> (ç­”æ¡ˆ: ${correctWord})`;
                    // Update passage visually
                    if (placeholderEl) {
                        placeholderEl.innerHTML = `<span class="cloze-number">${qNum}</span> <span class="text-green-700 font-bold">${correctWord}</span>`;
                    }
                } else {
                    const selectedText = selected ? qItem.options[parseInt(selected.value)] : 'æœªä½œç­”';
                    const correctOption = String.fromCharCode(65 + qItem.correct);
                    resultEl.innerHTML = `<span class="text-red-600">âŒ é”™è¯¯</span> (æ­£ç¡®ç­”æ¡ˆ: ${correctOption}. ${correctWord})`;
                    // Update passage visually
                    if (placeholderEl) {
                        placeholderEl.innerHTML = `<span class="cloze-number">${qNum}</span> <span class="text-red-700 font-bold">${selectedText || '___'}</span>`;
                    }
                }
            });

            document.getElementById('cloze-result').textContent = `å¾—åˆ†: ${score} / ${total}`;
            document.getElementById('cloze-check-btn').style.display = 'none';
        }

        function nextCloze() {
            currentClozeIndex = (currentClozeIndex + 1) % clozeQuizData.length;
            renderClozeQuiz();
        }

        function prevCloze() {
            currentClozeIndex = (currentClozeIndex - 1 + clozeQuizData.length) % clozeQuizData.length;
            renderClozeQuiz();
        }

        // --- 10. Initialization ---
        window.onload = function() {
            // Check initial state of the toggle and set showChineseTranslation
            const toggleEl = document.getElementById('chinese-toggle');
            if (toggleEl) {
                showChineseTranslation = toggleEl.checked;
            }
            
            showSection('vocab'); // Start on the vocabulary tab
            document.getElementById('vocab-card-container').addEventListener('click', flipVocab); 
            
            // Initial render for all sections
            renderVocabCard(); // Must call renderVocabCard explicitly to apply Chinese visibility to the card back
            renderSentence();
            renderGrammarQuiz();
            renderReadingQuiz();
            renderCompletionQuiz();
            renderClozeQuiz();

            // Ensure correct visibility on load for non-vocab sections
            updateContentVisibility(showChineseTranslation);
        };
    </script>
</body>
</html>